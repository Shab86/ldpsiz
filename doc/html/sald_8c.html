<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ldpsiz: sald.c File Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ldpsiz
   &#160;<span id="projectnumber">0.1</span>
   </div>
   <div id="projectbrief">LDPSIZ is a system of programs written in C and Python, which uses linkage disequilibrium to estimate parameters describing the history of population size.</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">sald.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>use simplex-simulated annealing to estimate population history  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_rng.h&gt;</code><br/>
<code>#include &lt;gsl/gsl_randist.h&gt;</code><br/>
<code>#include &lt;float.h&gt;</code><br/>
<code>#include &lt;getopt.h&gt;</code><br/>
<code>#include &lt;pthread.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;limits.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="misc_8h_source.html">misc.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="boot_8h_source.html">boot.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pophist_8h_source.html">pophist.h</a>&quot;</code><br/>
<code>#include &quot;sasimplex.h&quot;</code><br/>
<code>#include &quot;<a class="el" href="tokenizer_8h_source.html">tokenizer.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="jobqueue_8h_source.html">jobqueue.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hill_8h_source.html">hill.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ini_8h_source.html">ini.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="model_8h_source.html">model.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="assign_8h_source.html">assign.h</a>&quot;</code><br/>
<code>#include &quot;annealsched.h&quot;</code><br/>
</div><table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_task_arg.html">TaskArg</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The total job is divided into tasks, which are placed on a queue.  <a href="struct_task_arg.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_cost_par.html">CostPar</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameters of cost function--that which is minimized.  <a href="struct_cost_par.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a18891ed90ad4c8ca93859cb64935f396"></a><!-- doxytag: member="sald.c::DPRINTF" ref="a18891ed90ad4c8ca93859cb64935f396" args="(arg)" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><b>DPRINTF</b>(arg)</td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8605e2b78cd4a81b6c6b5c30cb7366a"></a><!-- doxytag: member="sald.c::usage" ref="ae8605e2b78cd4a81b6c6b5c30cb7366a" args="(void)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>usage</b> (void)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sald_8c.html#a206510e6ec3ac6cdc6f486e2eb905a2e">read_data</a> (FILE *ifp, int nbins, double *cm, double *sigdsq)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the data file produced by eld.  <a href="#a206510e6ec3ac6cdc6f486e2eb905a2e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a74d36ee8105258d687814f0d895083f1"></a><!-- doxytag: member="sald.c::TaskArg_new" ref="a74d36ee8105258d687814f0d895083f1" args="(unsigned task, unsigned seed, int nbins, double u, double ftol, double xtol, double *stepsize, AnnealSched *sched, double *loBnd, double *hiBnd, double *hiInit, double odeAbsTol, double odeRelTol, int nPerTmptr, int verbose, double *sigdsq_obs, double *c, Model *model, PopHist *ph_init, int randomStart)" -->
<a class="el" href="struct_task_arg.html">TaskArg</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sald_8c.html#a74d36ee8105258d687814f0d895083f1">TaskArg_new</a> (unsigned task, unsigned seed, int nbins, double u, double ftol, double xtol, double *stepsize, <a class="el" href="struct_anneal_sched.html">AnnealSched</a> *sched, double *loBnd, double *hiBnd, double *hiInit, double odeAbsTol, double odeRelTol, int nPerTmptr, int verbose, double *sigdsq_obs, double *c, <a class="el" href="struct_model.html">Model</a> *model, <a class="el" href="struct_pop_hist.html">PopHist</a> *ph_init, int randomStart)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="struct_task_arg.html" title="The total job is divided into tasks, which are placed on a queue.">TaskArg</a>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a30b29c5e8d06aa549b3045aece563d2f"></a><!-- doxytag: member="sald.c::TaskArg_free" ref="a30b29c5e8d06aa549b3045aece563d2f" args="(TaskArg *targ)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>TaskArg_free</b> (<a class="el" href="struct_task_arg.html">TaskArg</a> *targ)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4064d6ea80117361c95527ae2de4812d"></a><!-- doxytag: member="sald.c::taskfun" ref="a4064d6ea80117361c95527ae2de4812d" args="(void *varg)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>taskfun</b> (void *varg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sald_8c.html#a3feac96e0bc0242affd3d39e663d6469">costFun</a> (const gsl_vector *x, void *varg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sum of differences between observed and expected sigma_d^2 vectors.  <a href="#a3feac96e0bc0242affd3d39e663d6469"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4eed297e36284a739792864bee6880c7"></a><!-- doxytag: member="sald.c::CostPar_print" ref="a4eed297e36284a739792864bee6880c7" args="(CostPar *cp)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><b>CostPar_print</b> (<a class="el" href="struct_cost_par.html">CostPar</a> *cp)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8d9f16780283c0282645438e5ec9d9ba"></a><!-- doxytag: member="sald.c::TaskArg_best" ref="a8d9f16780283c0282645438e5ec9d9ba" args="(TaskArg **tpvec, int n)" -->
<a class="el" href="struct_task_arg.html">TaskArg</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sald_8c.html#a8d9f16780283c0282645438e5ec9d9ba">TaskArg_best</a> (<a class="el" href="struct_task_arg.html">TaskArg</a> **tpvec, int n)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Given a vector of <a class="el" href="struct_task_arg.html" title="The total job is divided into tasks, which are placed on a queue.">TaskArg</a> pointers, return a pointer to the one with lowest cost among those that have converged. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9aede0633e8d9580fba4c6fbb51bb4c5"></a><!-- doxytag: member="sald.c::prHeader" ref="a9aede0633e8d9580fba4c6fbb51bb4c5" args="(PopHist *ph)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="sald_8c.html#a9aede0633e8d9580fba4c6fbb51bb4c5">prHeader</a> (<a class="el" href="struct_pop_hist.html">PopHist</a> *ph)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Print header. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="sald.c::main" ref="a3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> (int argc, char **argv)</td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a477d3d43ac129230718eb9cef3c39d2e"></a><!-- doxytag: member="sald.c::setSimplexVersion" ref="a477d3d43ac129230718eb9cef3c39d2e" args="" -->
const int&#160;</td><td class="memItemRight" valign="bottom"><b>setSimplexVersion</b></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afa7545f118a9db1a066a2f0c4fd79357"></a><!-- doxytag: member="sald.c::stdoutLock" ref="afa7545f118a9db1a066a2f0c4fd79357" args="" -->
pthread_mutex_t&#160;</td><td class="memItemRight" valign="bottom"><b>stdoutLock</b> = PTHREAD_MUTEX_INITIALIZER</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>use simplex-simulated annealing to estimate population history </p>
<p><a class="anchor" id="sald"></a>`sald`: use simplex-simulated annealing to estimate population history ======================================================================</p>
<p>To estimate the parameters describing population history, we need to find values that provide the best fit to LD data. This involves maximization on a complex surface with lots of local peaks. (To verify this for yourself, see <a class="el" href="mcmcld_8c.html#mcmcld">mcmcld</a>.) To avoid getting stuck on local peaks, `sald` uses the simplex version of simulated annealing.</p>
<p>Usage -----</p>
<p>The input data file should be as produced by <a class="el" href="eld_8c.html#eld">eld</a>.</p>
<p>Although simulated annealing works pretty well, I often find that different runs end up on different peaks. Therefore, `sald` is able to launch multiple simulated annealing jobs, each from a random starting point. These can run in parallel, on separate threads. The number of parallel optimizers is set using the `--nOpt` argument described below.</p>
<p>The program also deals with bootstrap data, as provided by <a class="el" href="eld_8c.html#eld">eld</a>. The various boostrap data sets also run in parallel if your machine has multiple cores. By default `sald` does not process bootstrap replicates: use `--bootfile` if you want it to.</p>
<p>By default `sald` uses as many threads as your machine has cores. This is not a good idea if you are sharing a machine with other users. Set the number of threads to some smaller number using `--threads`. On linux or osx, you can use `top` to figure out how many threads are actually running. If you launch 20 threads but only 10 run at any given time, your job will run slower. Stop it and launch again with `--threads 10`.</p>
<p>Simulated annealing works by beginning with a flattened version of your objective function. In this flattened version, all the peaks are smaller, so it is easy for the simplex to move from peak to peak. The extent of flattening is controlled by a parameter called "temperature". High temperature corresponds to lots of flattening. The annealing algorithm runs for awhile at a high temperature, then lowers the temperature and runs awhile more. The succession of temperatures and the number of iterations at each temperature is called the "annealing schedule". You can change the performance of the algorithm by adjusting this schedule. See the `--initTmptr`, `--nPerTmptr` and `--tmptrDecay` arguments.</p>
<p>usage: sald [options] input_file_name where options may include: -m &lt;method&gt; or --methods &lt;method&gt; specify method "Hill", or "Strobeck", or "Hill,Strobeck" -n &lt;x&gt; or --twoNsmp &lt;x&gt; haploid sample size -t &lt;x&gt; or --threads &lt;x&gt; number of threads (default is auto) -u &lt;x&gt; or --mutation &lt;x&gt; mutation rate/generation -v &lt;x&gt; or --verbose more output -f &lt;x&gt; or --bootfile &lt;x&gt; read bootstrap file x -c &lt;x&gt; or --confidence &lt;x&gt; specify confidence level for CIs of parameters --twoN &lt;x&gt; haploid pop size to x in current epoch -T &lt;x&gt; or --time &lt;x&gt; length of current epoch (generations) -E or --nextepoch move to next earlier epoch --noRandomStart Don't initialize <a class="el" href="struct_pop_hist.html" title="PopHist represents the history of a single population.">PopHist</a> at random --nOpt &lt;x&gt; optimizers per data set --initTmptr &lt;x&gt; initial temperature --nTmptrs &lt;x&gt; number of temperatures --tmptrDecay &lt;x&gt; ratio of successive temperatures -i &lt;x&gt; or --nItr &lt;x&gt; total number of iterations -h or --help print this message</p>
<dl class="copyright"><dt><b>Copyright:</b></dt><dd>Copyright (c) 2014, Alan R. Rogers &lt;<a href="mailto:rogers@anthro.utah.edu">rogers@anthro.utah.edu</a>&gt;. This file is released under the Internet Systems Consortium License, which can be found in file "LICENSE". </dd></dl>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3feac96e0bc0242affd3d39e663d6469"></a><!-- doxytag: member="sald.c::costFun" ref="a3feac96e0bc0242affd3d39e663d6469" args="(const gsl_vector *x, void *varg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static double <a class="el" href="sald_8c.html#a3feac96e0bc0242affd3d39e663d6469">costFun</a> </td>
          <td>(</td>
          <td class="paramtype">const gsl_vector *&#160;</td>
          <td class="paramname"><em>x</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>varg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Sum of differences between observed and expected sigma_d^2 vectors. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ph</td><td>Current population history </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">u</td><td>mutation rate per site per generation </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nbins</td><td>Number of values in vectors obs and c </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sigdsq</td><td>Vector of nbins values, the observed values of sigdsq. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">c</td><td>Vector of nbins values, the recombination rates associated with the values in sigdsq. </td></tr>
  </table>
  </dd>
</dl>

<p>References <a class="el" href="model_8c.html#a64672253a3cad1e64368b829f52f252a">ODE_ldVec()</a>, <a class="el" href="pophist_8c.html#ae4d28244de462cde7a4aa8e6fe4da627">PopHist_nParams()</a>, <a class="el" href="pophist_8c.html#ac9dbfb2caae1f94acdb3e9dc93dda327">PopHist_paramName()</a>, <a class="el" href="pophist_8c.html#ac5ced8d9ab6d10c1b6b78b34af548f0c">PopHist_paramValue()</a>, <a class="el" href="pophist_8c.html#aaa5796bc8091de8e006e670763b4c306">PopHist_print()</a>, and <a class="el" href="pophist_8c.html#a73315ddb22b4f172a82fb97ff2c7ad4c">vector_to_PopHist()</a>.</p>

</div>
</div>
<a class="anchor" id="a206510e6ec3ac6cdc6f486e2eb905a2e"></a><!-- doxytag: member="sald.c::read_data" ref="a206510e6ec3ac6cdc6f486e2eb905a2e" args="(FILE *ifp, int nbins, double *cm, double *sigdsq)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="sald_8c.html#a206510e6ec3ac6cdc6f486e2eb905a2e">read_data</a> </td>
          <td>(</td>
          <td class="paramtype">FILE *&#160;</td>
          <td class="paramname"><em>ifp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nbins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>cm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double *&#160;</td>
          <td class="paramname"><em>sigdsq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Read the data file produced by eld. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ifp</td><td>Points to file produced by eld. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nbins</td><td>The length of all arrays. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">cm</td><td>An array giving the average separation (in centimorgans) between pairs of SNPs within the various bins. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">sigdsq</td><td>An array of estimates of sigma_d^2.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>number of lines read </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed May 28 2014 14:13:35 for ldpsiz by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
